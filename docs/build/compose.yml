
services:
#-------------------------------------------------------------
  worker:
    build: 
      context: .
      target: worker
    hostname: worker.example.com
    volumes:
      - ./worker:/root
    ports:
      - "8787:8787"
    profiles:
      - otro
    command:
      - wrangler
      - dev
      - rollup.config.js 


  #Esto parace ser un https://medium.com/the-capital/ethereum-fund-and-deploy-smart-contract-to-rinkeby-test-network-790562f5a9bc
  #tipo de testnet
  #también está disponible en Metamask
  #Let’s first connect to Localhost 8545. Before making a connection, you should have local (TestNet/Ganache) blockchain running in your local machine. This version of MetaMask does not automatically import accounts. One would have to manually import. On successful connection with Localhost click on the round colored circle marked as Click in below picture. Next, click on the Import Account option
  contract:
    build:
      context: .
      target: contract
    environment:
      dpak: "8dc139be3c85d64e2420f93eaf7a90d547f2b6fd3ebd0a72d4dce30a1bf4f145"
      NODE_OPTIONS: "--openssl-legacy-provider"
      ETHERSCAN_API_KEY: "EDBKYENP4HQJ3B5QAKJXUMDK245521HN7J"
    healthcheck:
      test: ["CMD-SHELL", "ping http://0.0.0.0:8545/"]
      interval: 10s
      timeout: 5s
      retries: 5
    volumes:
      - ./contract:/root
    profiles:
      - contratos
    ports:
      - "8545:8545"
    command: " npx hardhat node "




   #https://docs.ethers.io/v5/getting-started/
  ethers:
    build:
      context: .
      target: ethers
    volumes:
      - ./contract:/root
    profiles:
      - otro
    command: 
      - npm
      - run



  test:
    build:
      context: .
      target: contract
    environment:
      dpak: "8dc139be3c85d64e2420f93eaf7a90d547f2b6fd3ebd0a72d4dce30a1bf4f145"
      NODE_OPTIONS: "--openssl-legacy-provider"
      ETHERSCAN_API_KEY: "EDBKYENP4HQJ3B5QAKJXUMDK245521HN7J"
    volumes:
      - ./contract:/root
    ports:
      - "8546:8545"
    profiles:
      - otro
    command:
      - npx
      - hardhat
      - test 


  deploy:
    build:
      context: .
      target: contract
    environment:
      dpak: "8dc139be3c85d64e2420f93eaf7a90d547f2b6fd3ebd0a72d4dce30a1bf4f145"
      NODE_OPTIONS: "--openssl-legacy-provider"
      ETHERSCAN_API_KEY: "EDBKYENP4HQJ3B5QAKJXUMDK245521HN7J"
    volumes:
      - ./contract:/root
    profiles:
      - otro
    command: "npx hardhat run scripts/deploy.js"




  openzeppelin:
    build:
      context: .
      target: openzeppelin
    volumes:
      - ./openzeppelin:/root



  coin_sale:
    build:
      context: .
      target: contract
    environment:
      dpak: "8dc139be3c85d64e2420f93eaf7a90d547f2b6fd3ebd0a72d4dce30a1bf4f145"
      NODE_OPTIONS: "--openssl-legacy-provider"
      ETHERSCAN_API_KEY: "EDBKYENP4HQJ3B5QAKJXUMDK245521HN7J"
    volumes:
      - ./contract:/root
    profiles:
      - otro
    command:
      - npx
      - hardhat
      - run
      - scripts/start_coin_sale.js
        


  frontend:
    tty: true
    environment:
      HOST: 0.0.0.0 
    build:
      context: ../cfweb3
      target: frontend
    volumes:
      - ./frontend:/root
    profiles:
      - contratos
    ports:
      - "5002:5000"
    command:
      - npm
      - run 
      - dev
      - -- host
